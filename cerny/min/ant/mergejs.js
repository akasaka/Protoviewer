// (c) 2006-2008 Robert Cerny<![CDATA[CERNY.require("CERNY.ant.mergejs","CERNY.js.Array","CERNY.js.dependency");(function(){var method=CERNY.method;var intercept=CERNY.intercept;var expression=attributes.get("expression");var destFile=attributes.get("dest-file");var catalogFile=attributes.get("catalog-file");var baseDir=attributes.get("base-dir");var catalog=CERNY.Dictionary(CERNY.loadData(catalogFile));var listDependencies=CERNY.js.dependency.listDependencies;var logger=CERNY.Logger("CERNY.ant.MergeJs");function getResource(filename,lines){filename=baseDir+"/"+filename;lines=lines||200;var reader=new java.io.BufferedReader(new java.io.FileReader(filename));var content="";var line=null;var i=0;while((line=reader.readLine())!==null&&i<lines){content+=line+"\n";i+=1;}
return content;}
var origGetResource=CERNY.getResource;method(CERNY,"getResource",getResource);var dependencies=listDependencies(expression,catalog);method(CERNY,"getResource",origGetResource);var filenames=dependencies.map(function(exp){var value=catalog.lookup(exp);var v=value.split(",");return v.pop();});var files=filenames.join(",");var concatTask=project.createTask("concat");concatTask.setDestfile(new java.io.File(destFile));importClass(Packages.org.apache.tools.ant.types.FileList);var fileList=new FileList();fileList.setDir(new java.io.File(baseDir));fileList.setFiles(files);concatTask.addFilelist(fileList);concatTask.execute();})();]]>